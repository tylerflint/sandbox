#! /bin/bash
### BEGIN INIT INFO
# Provides:          unicorn-butler
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5
# Default-Stop:      0 1 6
# Short-Description: unicorn handler for tinybutler sinatra app
# Description:       unicorn handler for tinybutler sinatra app
### END INIT INFO

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
pidfile='/var/run/butler.pid'
config='/var/www/butler/config/unicorn.rb'
name='unicorn-butler'

. "/usr/local/rvm/scripts/rvm"

case "$1" in
  start)
	echo -n "Starting $name: "
	unicorn -c $config -E production -D
	echo "done."
	;;
  stop)
	echo -n "Stopping $name: "
	cat $pidfile | xargs kill -QUIT
    rm -f ${pidfile}
	echo "done."
	;;
  restart)
	echo -n "Restarting $name: "
	cat $pidfile | xargs kill -QUIT
    rm -f ${pidfile}
	sleep 1
	unicorn -c $config -E production -D
	echo "done."
	;;
  reload)
	echo -n "Reloading $name: "
	cat $pidfile | xargs kill -USR2
	echo "done."
	;;
  status)
	if [ -f $pidfile ]
	then
		echo "* $name is running"
	else
		echo "* $name is not running"
	fi
	;;
  *)
	echo "Usage: /etc/init.d/unicorn-butler {start|stop|restart|reload|status}" >&2
	exit 1
	;;
esac

exit 0